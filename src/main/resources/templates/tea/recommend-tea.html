<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Recommend Tea</title>
    <link rel="stylesheet" th:href="@{/css/recommend-tea.css}">
    <!-- defer 로 DOM 파싱 후 실행 -->
    <script defer src="/js/recommend-tea.js"></script>
</head>
<body>

<!-- ✅ 단일 폼으로 통일 -->
<form id="saveForm"
      th:action="@{/userdata/save}"
      method="post"
      th:if="${result.teas != null and !#lists.isEmpty(result.teas)}">

    <div class="page">

        <!-- 상단바 -->
        <div class="topbar">
            <a class="back" href="javascript:history.back();" aria-label="뒤로 가기">
                <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 36 36" fill="none">
                    <path d="M36 19.125H4.39453L18.2285 32.959L16.6465 34.541L0.105469 18L16.6465 1.45898L18.2285 3.04102L4.39453 16.875H36V19.125Z" fill="black"/>
                </svg>
            </a>
        </div>

        <!-- 본문 컨테이너 -->
        <div class="container">

            <!-- 제목 -->
            <div class="title-div">
                <h1 class="title">스트레스 받을 땐, 이런 차 어떠세요?</h1>
            </div>

            <!-- 차 선택 버튼 및 네비게이션 -->
            <div class="tea-menu-wrapper">
                <!-- ✅ form 안의 버튼은 기본 submit이라 type="button" 지정 -->
                <button type="button" class="pt-nav pt-prev hidden" id="ptPrev" aria-label="이전 보기">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                        <path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>

                <div class="tea-viewport" id="teaViewport">
                    <div class="tea-menu" id="teaMenu">
                        <!-- ✅ 버튼에 .tea-btn 클래스와 data-tea-id 부여, 인라인 onClick 제거 -->
                        <button type="button"
                                class="tea-btn"
                                th:each="tea : ${result.teas}"
                                th:text="${tea.name}"
                                th:attr="data-tea-id=${tea.id}">
                        </button>
                    </div>
                </div>

                <button type="button" class="pt-nav pt-next" id="ptNext" aria-label="다음 보기">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                        <path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>

            <!-- 배경 이미지 -->
            <div class="photo">
                <!-- ✅ <th:img> 가 아니라 <img th:src> 사용 -->
                <img th:src="@{/img/background.jpg}" alt="배경사진" class="bg">
            </div>

            <!-- ✅ 폼에 한 번만 존재하는 hidden inputs -->
            <input type="hidden" name="teaId" id="selectedTeaId" required>
            <input type="hidden"
                   th:name="${result.type == 'mood' ? 'moodId' : 'stateId'}"
                   th:value="${result.resultId != null ? result.resultId : 0}">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

            <!-- 차 설명 영역 (선택 시 표시) -->
            <div th:each="tea : ${result.teas}"
                 th:attr="data-tea-id=${tea.id}"
                 class="section tea-detail"
                 style="display:none;">

                <!-- 차 이름 -->
                <div th:text="${tea.name}" class="tea-name">차 이름</div>

                <!-- 차 설명 -->
                <div th:id="'detail_content_' + ${tea.id}" class="tea-text-parent">
                    <div class="tea-text">
                        <p th:text="${tea.content}">차 설명 텍스트</p>
                    </div>
                </div>

                <hr>

                <!-- 이렇게 먹는 걸 추천 -->
                <div th:id="'detail_eat_' + ${tea.id}" class="section">
                    <div class="title-2">이렇게 먹는 걸 추천드려요</div>
                    <div class="text-2" th:utext="${#strings.replace(tea.eat, '\n', '<br/>')}"></div>
                </div>

                <hr>

                <!-- 주의사항 -->
                <div th:id="'detail_caution_' + ${tea.id}" class="section">
                    <div class="title-2">이런 점은 조심해주세요</div>
                    <div class="text-2" th:utext="${#strings.replace(tea.caution, '\n', '<br/>')}"></div>
                </div>

                <!-- 선택 버튼 -->
                <div class="choose-btn-parent">
                    <button class="choose-btn" type="submit">이 차 선택하기</button>
                </div>
            </div>
        </div>
    </div>
</form>

</body>
</html>
