<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Recommend Tea</title>
    <link rel="stylesheet" th:href="@{/css/recommend-tea.css}">
    <script src="/js/recommend-tea.js" defer></script>
</head>
<body>
<form id="saveForm"
      th:action="@{/userdata/save}"
      method="post"
      th:attr="data-csrf-param=${_csrf.parameterName}, data-csrf-token=${_csrf.token}, data-choose-url=@{/choose}"
      th:if="${result.teas != null and !#lists.isEmpty(result.teas)}">
    <div class="page">

        <!-- 상단바 -->
        <div class="topbar">
            <a class="back" href="javascript:history.back();" aria-label="뒤로 가기">
                <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 36 36" fill="none">
                    <path
                            d="M36 19.125H4.39453L18.2285 32.959L16.6465 34.541L0.105469 18L16.6465 1.45898L18.2285 3.04102L4.39453 16.875H36V19.125Z"
                            fill="black" />
                </svg>
            </a>
        </div>

        <!-- 본문 컨테이너 -->
        <div class="container">

            <!-- 제목 -->
            <div class="title-div">
                <h1 class="title">스트레스 받을 땐, 이런 차 어떠세요?</h1>
            </div>

            <!-- 차 선택 버튼 및 네비게이션 -->
            <div class="tea-menu-wrapper">
                <button class="pt-nav pt-prev hidden" id="ptPrev" aria-label="이전 보기">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                        <path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2"
                              stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                </button>

                <div class="tea-viewport" id="teaViewport">
                    <div class="tea-menu" id="teaMenu">
                        <button type="button"
                                th:each="tea : ${result.teas}"
                                th:text="${tea.name}"
                                th:onclick="'selectTea(' + ${tea.id} + ');'">
                        </button>
                    </div>
                </div>

                <button class="pt-nav pt-next" id="ptNext">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                        <path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2"
                              stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                </button>
            </div>

            <!-- 배경 이미지 -->
            <div class="photo">
                <img src="/TeaProject/photo/뒷배경.jpg" alt="배경사진" class="bg">
            </div>

            <!-- 폼 시작 -->
            <form method="post" th:action="@{/recommend/result/submit}">

                <!-- 차 설명 영역 (선택 시 표시) -->
                <div th:each="tea : ${result.teas}" th:attr="data-tea-id=${tea.id}" class="section tea-detail" style="display: none;">

                    <!-- 차 이름 -->
                    <div th:text="${tea.name}" class="tea-name">차 이름</div>

                    <!-- 차 설명 -->
                    <div th:id="'detail_content_' + ${tea.id}" class="tea-text-parent">
                        <div class="tea-text">
                            <p th:text="${tea.content}">
                                차 설명 텍스트
                            </p>
                        </div>
                    </div>

                    <hr>

                    <!-- 추천 방법 -->
                    <!-- 추천 방법 -->
                    <div th:id="'detail_eat_' + ${tea.id}" class="section">
                        <div class="title-2">이렇게 먹는 걸 추천드려요</div>
                        <div class="text-2" th:utext="${#strings.replace(tea.eat, '\n', '<br/>')}"></div>
                    </div>

                    <hr>

                    <!-- 주의사항 -->
                    <div th:id="'detail_caution_' + ${tea.id}" class="section">
                        <div class="title-2">이런 점은 조심해주세요</div>
                        <div class="text-2" th:utext="${#strings.replace(tea.caution, '\n', '<br/>')}"></div>
                    </div>


                    <!-- 선택된 차 ID 저장 -->
                    <input type="hidden" name="teaId" id="selectedTeaId" required>

                    <!-- moodId 또는 stateId -->
                    <input type="hidden"
                           th:name="${result.type == 'mood' ? 'moodId' : 'stateId'}"
                           th:value="${result.resultId != null ? result.resultId : 0}" />

                    <!-- CSRF 토큰 -->
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

                    <!-- 차 선택 버튼 -->
                    <div class="choose-btn-parent">
                        <button class="choose-btn" type="submit">이 차 선택하기</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <script>
        // JavaScript로 선택된 차 정보 표시
        function selectTea(teaId) {
            // 모든 차 설명 숨기기
            document.querySelectorAll('.tea-detail').forEach(el => el.style.display = 'none');

            // 선택된 차 보여주기
            const selectedSection = document.querySelector('[data-tea-id="' + teaId + '"]');
            if (selectedSection) selectedSection.style.display = 'block';

            // hidden input에 teaId 저장
            document.getElementById('selectedTeaId').value = teaId;
        }
    </script>
</form>

</body>
</html>
