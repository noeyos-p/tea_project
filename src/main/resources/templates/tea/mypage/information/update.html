<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Information Update</title>
    <link rel="stylesheet" th:href="@{/css/information-update.css}">
    <script src="/js/information-update.js" defer></script>
</head>
<body th:with="m=${message}, e=${error}"
      th:attr="data-message=${m}, data-error=${e}">
<div class="wrap">
    <div class="topbar">
        <!-- 뒤로가기: 기존 디자인 유지, 실제 경로만 연결 -->
        <a class="back" th:href="@{/userdata/mypage}">
            <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 36 36" fill="none">
                <path d="M36 19.125H4.39453L18.2285 32.959L16.6465 34.541L0.105469 18L16.6465 1.45898L18.2285 3.04102L4.39453 16.875H36V19.125Z" fill="black" />
            </svg>
        </a>
    </div>
    <div class="tabs">
        <a class="tab" th:href="@{/userdata/mypage}">내 정보</a>
        <a class="tab-here" th:href="@{/userdata/mypage/memo/main}">기록보관함</a>
        <a class="tab" href="#">Q&amp;A</a>
    </div>
    <div class="actions">
    <!-- 차 추천받기 -->
    <form th:action="@{/choice}" method="get">
      <button class="choose" type="submit">차 추천받기</button>
    </form>

    <!-- 로그아웃 -->
    <form th:action="@{/logout}" method="post">
      <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
      <button  type="submit" class="logout">로그아웃</button>
    </form>

  </div>
</div>

<section class="card" aria-label="내 정보 카드">
    <div class="avatar">
        <svg xmlns="http://www.w3.org/2000/svg" width="112" height="112" viewBox="0 0 112 112" fill="none">
            <path d="M55.9998 55.9998C50.8665 55.9998 46.4721 54.1721 42.8165 50.5165C39.1609 46.8609 37.3332 42.4665 37.3332 37.3332C37.3332 32.1998 39.1609 27.8054 42.8165 24.1498C46.4721 20.4943 50.8665 18.6665 55.9998 18.6665C61.1332 18.6665 65.5276 20.4943 69.1832 24.1498C72.8387 27.8054 74.6665 32.1998 74.6665 37.3332C74.6665 42.4665 72.8387 46.8609 69.1832 50.5165C65.5276 54.1721 61.1332 55.9998 55.9998 55.9998ZM18.6665 83.9998V80.2665C18.6665 77.6221 19.3478 75.1923 20.7105 72.9772C22.0732 70.7621 23.8807 69.0696 26.1332 67.8998C30.9554 65.4887 35.8554 63.6812 40.8332 62.4772C45.8109 61.2732 50.8665 60.6696 55.9998 60.6665C61.1332 60.6634 66.1887 61.2669 71.1665 62.4772C76.1443 63.6874 81.0443 65.4949 85.8665 67.8998C88.1221 69.0665 89.9312 70.7589 91.2938 72.9772C92.6565 75.1954 93.3363 77.6252 93.3332 80.2665V83.9998C93.3332 86.5665 92.4201 88.7645 90.5938 90.5938C88.7676 92.4232 86.5696 93.3363 83.9998 93.3332H27.9998C25.4332 93.3332 23.2367 92.4201 21.4105 90.5938C19.5843 88.7676 18.6696 86.5696 18.6665 83.9998Z" fill="#BFAE9F" />
        </svg>
    </div>

    <!-- 디자인 유지: info 영역 안에서 닉네임/비밀번호만 수정 가능 -->
    <div class="info">
        <!-- 한 폼에서 닉네임/비밀번호를 함께 처리 -->
        <form id="signupForm" th:action="@{/userdata/mypage/update}" method="post" novalidate>
            <!-- CSRF (보안 사용 중일 때 자동 주입) -->
            <input th:if="${_csrf != null}" type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

            <!-- 닉네임: 기존 value를 입력칸으로 제공 (중복은 서버에서 검증/차단) -->
            <div class="row">
                <div class="label">닉네임</div>
                <input
                        id="nickname"
                        type="text"
                        name="nickname"
                        class="input"
                        th:value="${user != null} ? ${user.nickname} : ''"
                        minlength="6"
                        maxlength="20"
                        autocomplete="off"
                        placeholder="새 닉네임을 입력하세요"/>
            </div>

            <!-- 이메일: 그대로 표시(수정 불가) -->
            <div class="row" th:if="${user != null}">
                <div class="label">이메일</div>
                <div class="value" th:text="${user.email}">krapnoeyos@gmail.com</div>
            </div>

            <!--  비밀번호: 새 비밀번호/확인 (재사용 금지는 서버에서 검증/차단) -->
            <div class="row">
                <div class="label">비밀번호</div>
                <input id="pw" type="password" name="password" class="input"
                       minlength="8" autocomplete="new-password" placeholder="새 비밀번호(선택)" />
            </div>

            <div class="row">
                <div class="label">비밀번호 확인</div>
                <input id="confirm-pw" type="password" name="confirmPassword" class="input"
                       minlength="8" autocomplete="new-password" placeholder="새 비밀번호 확인(선택)" />
            </div>
            <div class="buttons">
                <button class="btn primary" type="submit">완료</button>
                <a class="btn ghost" th:href="@{/userdata/mypage}" role="button">취소</a>
            </div>
        </form>
    </div>
</section>

<!-- 선택: 간단한 클라이언트 유효성 (비번 입력 시에만 확인/길이 체크) -->
<script>

</script>
</body>
</html>