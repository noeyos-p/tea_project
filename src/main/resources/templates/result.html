<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>추천 결과</title>
</head>
<body>
<h1>추천 결과</h1>

<!-- 1. 추천 결과 메시지 -->
<div th:if="${result}">
    <p><strong>결과 메시지:</strong></p>
<!--    결과값이 두줄이면 한줄 띄고 두줄 나오게-->
    <p th:utext="${#strings.replace(result.message, '\n', '<br/>')}"></p>
</div>

<!-- 2. 추천 차 목록 (클릭하면 상세 정보 토글) -->
<div th:if="${result.teas}">
    <p><strong>추천 차 목록:</strong></p>
    <ul>
        <li th:each="tea : ${result.teas}">
            <a href="#" th:text="${tea.name}" th:onclick="'toggleDetail(' + ${tea.id} + '); return false;'"></a>
            <div th:id="'detail_' + ${tea.id}" style="display:none; margin-left:20px;">
                <p><strong>효능:</strong> <span th:text="${tea.content}"></span></p>
                <p><strong>섭취법:</strong> <span th:text="${tea.eat}"></span></p>
                <p><strong>주의사항:</strong> <span th:text="${tea.caution}"></span></p>
            </div>
        </li>
    </ul>
</div>

<!-- 3. 체크리스트 돌아가기 링크 -->
<p>
    <a th:href="@{/mood/checklist}">무드 체크리스트로 돌아가기</a> |
    <a th:href="@{/state/checklist}">상태 체크리스트로 돌아가기</a>
</p>

<!-- 4. 마음에 드는 차 선택 후 저장 -->
<div th:if="${result.teas}">
    <h2>마음에 드는 차를 하나 선택하세요:</h2>
    <form th:action="@{/userdata/save}" method="post">
        <div th:each="tea : ${result.teas}">
            <input type="radio" name="teaId" th:value="${tea.id}" th:id="${'tea_' + tea.id}">
            <label th:for="${'tea_' + tea.id}" th:text="${tea.name}"></label><br>
        </div>

        <!-- Mood/State ID 숨김 (선택한 결과 타입만 전달) -->
        <input type="hidden" name="moodId" th:value="${result.resultId}" th:if="${result.type == 'mood'}"/>
        <input type="hidden" name="stateId" th:value="${result.resultId}" th:if="${result.type == 'state'}"/>

        <!-- CSRF 토큰 -->
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

        <button type="submit">마이페이지에 저장하기</button>
    </form>
</div>

<!-- 상세 정보 토글 스크립트 -->
<script>
    function toggleDetail(id) {
        const div = document.getElementById('detail_' + id);
        div.style.display = div.style.display === 'none' ? 'block' : 'none';
    }
</script>

</body>
</html>
