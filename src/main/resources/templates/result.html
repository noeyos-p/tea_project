<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>추천 결과</title>
</head>
<body>
<h1>추천 결과</h1>

<!-- 결과 메시지 -->
<div th:if="${result != null}">
    <p><strong>결과 메시지:</strong></p>
    <p th:utext="${#strings.replace(result.message != null ? result.message : '', '\n', '<br/>')}"></p>
</div>

<!-- 추천 차 목록 -->
<div th:if="${result.teas != null and !#lists.isEmpty(result.teas)}">
    <p><strong>추천 차 목록:</strong></p>
    <ul>
        <li th:each="tea : ${result.teas}">
            <!-- 버튼 클릭 시 상세 토글 -->
            <button type="button" th:text="${tea.name}"
                    th:onclick="'toggleDetail(' + ${tea.id} + ');'"></button>
            <div th:id="'detail_' + ${tea.id}" style="display:none; margin-left:20px;">
                <p><strong>효능:</strong> <span th:text="${tea.content}"></span></p>
                <p><strong>섭취법:</strong> <span th:text="${tea.eat}"></span></p>
                <p><strong>주의사항:</strong> <span th:text="${tea.caution}"></span></p>
            </div>
        </li>
    </ul>
</div>

<!-- 선택 후 마이페이지 저장 -->
<form th:action="@{/userdata/save}" method="post" th:if="${result.teas != null and !#lists.isEmpty(result.teas)}">
    <div th:each="tea : ${result.teas}">
        <input type="radio" name="teaId" th:value="${tea.id}" th:id="${'tea_' + tea.id}" required>
        <label th:for="${'tea_' + tea.id}" th:text="${tea.name}"></label><br>
    </div>

    <!-- 체크리스트 유형에 따라 hidden 값 전달 -->
    <input type="hidden" th:name="${result.type == 'mood' ? 'moodId' : 'stateId'}"
           th:value="${result.resultId != null ? result.resultId : 0}"/>

    <!-- CSRF 토큰 -->
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

    <button type="submit">마이페이지에 저장하기</button>
</form>

<!-- 상세 정보 토글 스크립트 -->
<script>
    function toggleDetail(id) {
        const div = document.getElementById('detail_' + id);
        if (!div) return;
        div.style.display = div.style.display === 'none' ? 'block' : 'none';
    }
</script>

<!-- 체크리스트로 돌아가기 -->
<a th:href="@{/mood/checklist}">무드 체크리스트로 돌아가기</a> |
<a th:href="@{/state/checklist}">상태 체크리스트로 돌아가기</a>
</body>
</html>
